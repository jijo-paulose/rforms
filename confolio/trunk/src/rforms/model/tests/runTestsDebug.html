<html>
  <head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title></title>
  </head>
  <body>
	<script type="text/javascript" src="../../../../lib/dojo/dojo/dojo.js.uncompressed.js"
		djConfig="isDebug: true, debugAtAllCosts: true, parseOnLoad: false, usePlainJson: true"></script>
	<script type="text/javascript">
		dojo.registerModulePath("rforms","../../../src/rforms");
		dojo.registerModulePath("rdfjson","../../../src/rdfjson");
		dojo.require("rforms.model.Engine");
		dojo.require("rforms.model.GroupBinding");
		dojo.require("rforms.model.PropertyGroupBinding");
		dojo.require("rforms.model.ValueBinding");
		dojo.require("rforms.template.ItemStore");
		dojo.require("rdfjson.Graph");
		dojo.require("rdfjson.tests.data");
		dojo.require("rforms.template.tests.data");

		dojo.addOnLoad(function() {
			var doh = {};
			doh.t = function(val) {
				if (!val) {
					alert("doh error");
				}
			};
			doh.f = function(val) {
				if (val) {
					alert("doh error");
				} 
			};
			debugger;

			//Paste code from the tests below (within start and end mark) to be able to debug them,
			//remove any use of doh to allow independent debugging.
			//-------------------------START----------------------------------------
	this.graph = new rdfjson.Graph({});
	this.s1 = this.graph.create("re1", "http://purl.org/dc/elements/1.1/creator", {"type": "bnode", "value": "_:person"});
	this.s2 = this.graph.create("_:person", "http://www.w3.org/TR/rdf-schema/type", {"type": "uri", "value": "http://xmlns.com/foaf/0.1/Person"});
	this.s3 = this.graph.create("_:person", "http://xmlns.com/foaf/0.1/firstname", {"type": "literal", "value": "Anna"});
	this.s4 = this.graph.create("re1", "http://purl.org/dc/elements/1.1/title", {"type": "literal", "value": "Some title"});
	this.is = new rforms.template.ItemStore();
	this.t1 = this.is.createTemplate(rforms.template.tests.template1);	
	this.b1 = new rforms.model.GroupBinding({item: this.t1.getRoot()});
	this.b2 = new rforms.model.PropertyGroupBinding({item: this.t1.getRoot().getChildren()[4], statement: this.s1, constraints: [this.s2]});
	this.b3 = new rforms.model.ValueBinding({item: this.t1.getRoot().getChildren()[4].getChildren()[1].getChildren()[0], statement: this.s3});
	this.b4 = new rforms.model.ValueBinding({item: this.t1.getRoot().getChildren()[1], statement: this.s4});
	this.b1.addChildBinding(this.b2);
	this.b2.getObjectBinding().addChildBinding(this.b3);
	this.b1.addChildBinding(this.b4);


		//First check leaf validity effect.
		doh.t(this.s1.isAsserted());
		doh.t(this.s2.isAsserted());
		doh.t(this.s3.isAsserted());
		doh.t(this.s4.isAsserted());
		this.b3.setValue("");
		doh.f(this.s1.isAsserted());
		doh.f(this.s2.isAsserted());
		doh.f(this.s3.isAsserted());
		doh.t(this.s4.isAsserted());
		this.b3.setValue("Anna");
		doh.t(this.s1.isAsserted());
		doh.t(this.s2.isAsserted());
		doh.t(this.s3.isAsserted());
		doh.t(this.s4.isAsserted());
		//Second, check hierarchy updated when predicate changed above.
		this.b2.getPredicateBinding().setValue("");
		doh.f(this.s1.isAsserted());
		doh.f(this.s2.isAsserted());
		doh.f(this.s3.isAsserted());
		doh.t(this.s4.isAsserted());
		this.b2.getPredicateBinding().setValue("http://purl.org/dc/elements/1.1/creator");
		doh.t(this.s1.isAsserted());
		doh.t(this.s2.isAsserted());
		doh.t(this.s3.isAsserted());
		doh.t(this.s4.isAsserted());
			//-------------------------END----------------------------------------
			console.log("A sensless log entry, to be able to step over last code row in firebug above.")
		});
	</script>
  </body>
</html>
